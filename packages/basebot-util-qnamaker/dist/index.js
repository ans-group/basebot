"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports["default"] = void 0;var _requestPromiseNative = _interopRequireDefault(require("request-promise-native"));function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { "default": obj };}function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {try {var info = gen[key](arg);var value = info.value;} catch (error) {reject(error);return;}if (info.done) {resolve(value);} else {Promise.resolve(value).then(_next, _throw);}}function _asyncToGenerator(fn) {return function () {var self = this,args = arguments;return new Promise(function (resolve, reject) {var gen = fn.apply(self, args);function _next(value) {asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);}function _throw(err) {asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);}_next(undefined);});};}var _default =

function _default(logger) {return (/*#__PURE__*/function () {var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(bot, message, next) {var info, error, threshold, url, res;return regeneratorRuntime.wrap(function _callee$(_context) {while (1) {switch (_context.prev = _context.next) {case 0:
                info = logger('qnaMaker', 'info');
                error = logger('qnaMaker', 'error');
                threshold = process.env.QNA_THRESHOLD || 70;if (!(
                !process.env.QNA_HOST || !process.env.QNA_KBID || !process.env.QNA_KEY)) {_context.next = 6;break;}
                info('not using QNA Maker as no key provided');return _context.abrupt("return",
                bot.reply(message, "Didn't catch that, sorry"));case 6:

                url = "".concat(process.env.QNA_HOST, "/knowledgebases/").concat(process.env.QNA_KBID, "/generateAnswer");_context.prev = 7;_context.next = 10;return (

                  _requestPromiseNative["default"].post(url, {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json',
                      'Authorization': "EndpointKey ".concat(process.env.QNA_KEY) },

                    json: { question: message.text } }));case 10:res = _context.sent;if (!(

                res.answers && res.answers.length && res.answers[0].score > threshold)) {_context.next = 15;break;}return _context.abrupt("return",
                bot.reply(message, res.answers[0].answer));case 15:return _context.abrupt("return",

                next());case 16:_context.next = 22;break;case 18:_context.prev = 18;_context.t0 = _context["catch"](7);


                bot.reply(message, "Didn't catch that, sorry");
                error('Could not check QNA Maker', _context.t0);case 22:case "end":return _context.stop();}}}, _callee, null, [[7, 18]]);}));return function (_x, _x2, _x3) {return _ref.apply(this, arguments);};}());};exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2luZGV4LmpzIl0sIm5hbWVzIjpbImxvZ2dlciIsImJvdCIsIm1lc3NhZ2UiLCJuZXh0IiwiaW5mbyIsImVycm9yIiwidGhyZXNob2xkIiwicHJvY2VzcyIsImVudiIsIlFOQV9USFJFU0hPTEQiLCJRTkFfSE9TVCIsIlFOQV9LQklEIiwiUU5BX0tFWSIsInJlcGx5IiwidXJsIiwicmVxdWVzdCIsInBvc3QiLCJtZXRob2QiLCJoZWFkZXJzIiwianNvbiIsInF1ZXN0aW9uIiwidGV4dCIsInJlcyIsImFuc3dlcnMiLCJsZW5ndGgiLCJzY29yZSIsImFuc3dlciJdLCJtYXBwaW5ncyI6InVHQUFBLHNGOztBQUVlLGtCQUFBQSxNQUFNLHdHQUFJLGlCQUFlQyxHQUFmLEVBQW9CQyxPQUFwQixFQUE2QkMsSUFBN0I7QUFDakJDLGdCQUFBQSxJQURpQixHQUNWSixNQUFNLENBQUMsVUFBRCxFQUFhLE1BQWIsQ0FESTtBQUVqQkssZ0JBQUFBLEtBRmlCLEdBRVRMLE1BQU0sQ0FBQyxVQUFELEVBQWEsT0FBYixDQUZHO0FBR2pCTSxnQkFBQUEsU0FIaUIsR0FHTEMsT0FBTyxDQUFDQyxHQUFSLENBQVlDLGFBQVosSUFBNkIsRUFIeEI7QUFJbkIsaUJBQUNGLE9BQU8sQ0FBQ0MsR0FBUixDQUFZRSxRQUFiLElBQXlCLENBQUNILE9BQU8sQ0FBQ0MsR0FBUixDQUFZRyxRQUF0QyxJQUFrRCxDQUFDSixPQUFPLENBQUNDLEdBQVIsQ0FBWUksT0FKNUM7QUFLckJSLGdCQUFBQSxJQUFJLENBQUMsd0NBQUQsQ0FBSixDQUxxQjtBQU1kSCxnQkFBQUEsR0FBRyxDQUFDWSxLQUFKLENBQVVYLE9BQVYsNkJBTmM7O0FBUWpCWSxnQkFBQUEsR0FSaUIsYUFRUlAsT0FBTyxDQUFDQyxHQUFSLENBQVlFLFFBUkosNkJBUStCSCxPQUFPLENBQUNDLEdBQVIsQ0FBWUcsUUFSM0M7O0FBVUhJLG1EQUFRQyxJQUFSLENBQWFGLEdBQWIsRUFBa0I7QUFDbENHLG9CQUFBQSxNQUFNLEVBQUUsTUFEMEI7QUFFbENDLG9CQUFBQSxPQUFPLEVBQUU7QUFDUCxzQ0FBZ0Isa0JBRFQ7QUFFUCw2REFBZ0NYLE9BQU8sQ0FBQ0MsR0FBUixDQUFZSSxPQUE1QyxDQUZPLEVBRnlCOztBQU1sQ08sb0JBQUFBLElBQUksRUFBRSxFQUFFQyxRQUFRLEVBQUVsQixPQUFPLENBQUNtQixJQUFwQixFQU40QixFQUFsQixDQVZHLFVBVWZDLEdBVmU7O0FBa0JqQkEsZ0JBQUFBLEdBQUcsQ0FBQ0MsT0FBSixJQUFlRCxHQUFHLENBQUNDLE9BQUosQ0FBWUMsTUFBM0IsSUFBcUNGLEdBQUcsQ0FBQ0MsT0FBSixDQUFZLENBQVosRUFBZUUsS0FBZixHQUF1Qm5CLFNBbEIzQztBQW1CWkwsZ0JBQUFBLEdBQUcsQ0FBQ1ksS0FBSixDQUFVWCxPQUFWLEVBQW1Cb0IsR0FBRyxDQUFDQyxPQUFKLENBQVksQ0FBWixFQUFlRyxNQUFsQyxDQW5CWTs7QUFxQlp2QixnQkFBQUEsSUFBSSxFQXJCUTs7O0FBd0JyQkYsZ0JBQUFBLEdBQUcsQ0FBQ1ksS0FBSixDQUFVWCxPQUFWO0FBQ0FHLGdCQUFBQSxLQUFLLENBQUMsMkJBQUQsY0FBTCxDQXpCcUIsMEVBQUosOEUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcmVxdWVzdCBmcm9tICdyZXF1ZXN0LXByb21pc2UtbmF0aXZlJ1xuXG5leHBvcnQgZGVmYXVsdCBsb2dnZXIgPT4gYXN5bmMgZnVuY3Rpb24oYm90LCBtZXNzYWdlLCBuZXh0KSB7XG4gIGNvbnN0IGluZm8gPSBsb2dnZXIoJ3FuYU1ha2VyJywgJ2luZm8nKVxuICBjb25zdCBlcnJvciA9IGxvZ2dlcigncW5hTWFrZXInLCAnZXJyb3InKVxuICBjb25zdCB0aHJlc2hvbGQgPSBwcm9jZXNzLmVudi5RTkFfVEhSRVNIT0xEIHx8IDcwXG4gIGlmICghcHJvY2Vzcy5lbnYuUU5BX0hPU1QgfHwgIXByb2Nlc3MuZW52LlFOQV9LQklEIHx8ICFwcm9jZXNzLmVudi5RTkFfS0VZKSB7XG4gICAgaW5mbygnbm90IHVzaW5nIFFOQSBNYWtlciBhcyBubyBrZXkgcHJvdmlkZWQnKVxuICAgIHJldHVybiBib3QucmVwbHkobWVzc2FnZSwgYERpZG4ndCBjYXRjaCB0aGF0LCBzb3JyeWApXG4gIH1cbiAgY29uc3QgdXJsID0gYCR7cHJvY2Vzcy5lbnYuUU5BX0hPU1R9L2tub3dsZWRnZWJhc2VzLyR7cHJvY2Vzcy5lbnYuUU5BX0tCSUR9L2dlbmVyYXRlQW5zd2VyYFxuICB0cnkge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcXVlc3QucG9zdCh1cmwsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBFbmRwb2ludEtleSAke3Byb2Nlc3MuZW52LlFOQV9LRVl9YFxuICAgICAgfSxcbiAgICAgIGpzb246IHsgcXVlc3Rpb246IG1lc3NhZ2UudGV4dCB9XG4gICAgfSlcbiAgICBpZiAocmVzLmFuc3dlcnMgJiYgcmVzLmFuc3dlcnMubGVuZ3RoICYmIHJlcy5hbnN3ZXJzWzBdLnNjb3JlID4gdGhyZXNob2xkKSB7XG4gICAgICByZXR1cm4gYm90LnJlcGx5KG1lc3NhZ2UsIHJlcy5hbnN3ZXJzWzBdLmFuc3dlcilcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIG5leHQoKVxuICAgIH1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgYm90LnJlcGx5KG1lc3NhZ2UsIGBEaWRuJ3QgY2F0Y2ggdGhhdCwgc29ycnlgKVxuICAgIGVycm9yKCdDb3VsZCBub3QgY2hlY2sgUU5BIE1ha2VyJywgZXJyKVxuICB9XG59XG4iXX0=