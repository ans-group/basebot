"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports["default"] = void 0;var responses = [];var _default =

function _default(_ref) {var storage = _ref.storage;
  // fetch emergency responses
  fetchEmergencyResponses();
  setInterval(fetchEmergencyResponses, 1000 * 60 * 2);
  return function (bot, message, next) {
    var found = false;
    responses.forEach(function (item) {
      item.phrases.forEach(function (phrase) {
        if (message.text && message.text.includes(phrase) && !found) {
          found = true;
          bot.reply(message, item.response);
        }
      });
    });
    if (!found) {
      return next();
    }
  };
  function fetchEmergencyResponses() {
    storage.responses.all({ key: 'priority', value: '1', attributes: ['intentName', 'response', 'phrases', 'voiceEnabled'] }).
    then(function (emergencyResponses) {
      responses = emergencyResponses;
    });
  }
};exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2luZGV4LmpzIl0sIm5hbWVzIjpbInJlc3BvbnNlcyIsInN0b3JhZ2UiLCJmZXRjaEVtZXJnZW5jeVJlc3BvbnNlcyIsInNldEludGVydmFsIiwiYm90IiwibWVzc2FnZSIsIm5leHQiLCJmb3VuZCIsImZvckVhY2giLCJpdGVtIiwicGhyYXNlcyIsInBocmFzZSIsInRleHQiLCJpbmNsdWRlcyIsInJlcGx5IiwicmVzcG9uc2UiLCJhbGwiLCJrZXkiLCJ2YWx1ZSIsImF0dHJpYnV0ZXMiLCJ0aGVuIiwiZW1lcmdlbmN5UmVzcG9uc2VzIl0sIm1hcHBpbmdzIjoidUdBQUEsSUFBSUEsU0FBUyxHQUFHLEVBQWhCLEM7O0FBRWUsd0JBQWlCLEtBQWRDLE9BQWMsUUFBZEEsT0FBYztBQUM5QjtBQUNBQyxFQUFBQSx1QkFBdUI7QUFDdkJDLEVBQUFBLFdBQVcsQ0FBQ0QsdUJBQUQsRUFBMEIsT0FBTyxFQUFQLEdBQVksQ0FBdEMsQ0FBWDtBQUNBLFNBQU8sVUFBQ0UsR0FBRCxFQUFNQyxPQUFOLEVBQWVDLElBQWYsRUFBd0I7QUFDN0IsUUFBSUMsS0FBSyxHQUFHLEtBQVo7QUFDQVAsSUFBQUEsU0FBUyxDQUFDUSxPQUFWLENBQWtCLFVBQUFDLElBQUksRUFBSTtBQUN4QkEsTUFBQUEsSUFBSSxDQUFDQyxPQUFMLENBQWFGLE9BQWIsQ0FBcUIsVUFBQUcsTUFBTSxFQUFJO0FBQzdCLFlBQUlOLE9BQU8sQ0FBQ08sSUFBUixJQUFnQlAsT0FBTyxDQUFDTyxJQUFSLENBQWFDLFFBQWIsQ0FBc0JGLE1BQXRCLENBQWhCLElBQWlELENBQUNKLEtBQXRELEVBQTZEO0FBQzNEQSxVQUFBQSxLQUFLLEdBQUcsSUFBUjtBQUNBSCxVQUFBQSxHQUFHLENBQUNVLEtBQUosQ0FBVVQsT0FBVixFQUFtQkksSUFBSSxDQUFDTSxRQUF4QjtBQUNEO0FBQ0YsT0FMRDtBQU1ELEtBUEQ7QUFRQSxRQUFJLENBQUNSLEtBQUwsRUFBWTtBQUNWLGFBQU9ELElBQUksRUFBWDtBQUNEO0FBQ0YsR0FiRDtBQWNBLFdBQVNKLHVCQUFULEdBQW1DO0FBQ2pDRCxJQUFBQSxPQUFPLENBQUNELFNBQVIsQ0FBa0JnQixHQUFsQixDQUFzQixFQUFFQyxHQUFHLEVBQUUsVUFBUCxFQUFtQkMsS0FBSyxFQUFFLEdBQTFCLEVBQStCQyxVQUFVLEVBQUUsQ0FBQyxZQUFELEVBQWUsVUFBZixFQUEyQixTQUEzQixFQUFzQyxjQUF0QyxDQUEzQyxFQUF0QjtBQUNHQyxJQUFBQSxJQURILENBQ1EsVUFBQUMsa0JBQWtCLEVBQUk7QUFDMUJyQixNQUFBQSxTQUFTLEdBQUdxQixrQkFBWjtBQUNELEtBSEg7QUFJRDtBQUNGLEMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgcmVzcG9uc2VzID0gW11cblxuZXhwb3J0IGRlZmF1bHQgKHsgc3RvcmFnZSB9KSA9PiB7XG4gIC8vIGZldGNoIGVtZXJnZW5jeSByZXNwb25zZXNcbiAgZmV0Y2hFbWVyZ2VuY3lSZXNwb25zZXMoKVxuICBzZXRJbnRlcnZhbChmZXRjaEVtZXJnZW5jeVJlc3BvbnNlcywgMTAwMCAqIDYwICogMilcbiAgcmV0dXJuIChib3QsIG1lc3NhZ2UsIG5leHQpID0+IHtcbiAgICBsZXQgZm91bmQgPSBmYWxzZVxuICAgIHJlc3BvbnNlcy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgaXRlbS5waHJhc2VzLmZvckVhY2gocGhyYXNlID0+IHtcbiAgICAgICAgaWYgKG1lc3NhZ2UudGV4dCAmJiBtZXNzYWdlLnRleHQuaW5jbHVkZXMocGhyYXNlKSAmJiAhZm91bmQpIHtcbiAgICAgICAgICBmb3VuZCA9IHRydWVcbiAgICAgICAgICBib3QucmVwbHkobWVzc2FnZSwgaXRlbS5yZXNwb25zZSlcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9KVxuICAgIGlmICghZm91bmQpIHtcbiAgICAgIHJldHVybiBuZXh0KClcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gZmV0Y2hFbWVyZ2VuY3lSZXNwb25zZXMoKSB7XG4gICAgc3RvcmFnZS5yZXNwb25zZXMuYWxsKHsga2V5OiAncHJpb3JpdHknLCB2YWx1ZTogJzEnLCBhdHRyaWJ1dGVzOiBbJ2ludGVudE5hbWUnLCAncmVzcG9uc2UnLCAncGhyYXNlcycsICd2b2ljZUVuYWJsZWQnXSB9KVxuICAgICAgLnRoZW4oZW1lcmdlbmN5UmVzcG9uc2VzID0+IHtcbiAgICAgICAgcmVzcG9uc2VzID0gZW1lcmdlbmN5UmVzcG9uc2VzXG4gICAgICB9KVxuICB9XG59XG4iXX0=