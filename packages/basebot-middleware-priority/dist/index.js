"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports["default"] = void 0;var responses = [];var _default =

function _default(_ref) {var storage = _ref.storage;
  // fetch emergency responses
  fetchEmergencyResponses();
  setInterval(fetchEmergencyResponses, 1000 * 60 * 2);
  return function (bot, message, next) {
    var found = false;
    responses.forEach(function (item) {
      item.phrases.forEach(function (phrase) {
        if (message.text.includes(phrase) && !found) {
          found = true;
          bot.reply(message, item.response);
        }
      });
    });
    if (!found) {
      return next();
    }
  };
  function fetchEmergencyResponses() {
    storage.responses.all({ key: 'priority', value: '1', attributes: ['intentName', 'response', 'phrases', 'voiceEnabled'] }).
    then(function (emergencyResponses) {
      responses = emergencyResponses;
    });
  }
};exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2luZGV4LmpzIl0sIm5hbWVzIjpbInJlc3BvbnNlcyIsInN0b3JhZ2UiLCJmZXRjaEVtZXJnZW5jeVJlc3BvbnNlcyIsInNldEludGVydmFsIiwiYm90IiwibWVzc2FnZSIsIm5leHQiLCJmb3VuZCIsImZvckVhY2giLCJpdGVtIiwicGhyYXNlcyIsInBocmFzZSIsInRleHQiLCJpbmNsdWRlcyIsInJlcGx5IiwicmVzcG9uc2UiLCJhbGwiLCJrZXkiLCJ2YWx1ZSIsImF0dHJpYnV0ZXMiLCJ0aGVuIiwiZW1lcmdlbmN5UmVzcG9uc2VzIl0sIm1hcHBpbmdzIjoidUdBQUEsSUFBSUEsU0FBUyxHQUFHLEVBQWhCLEM7O0FBRWUsd0JBQWlCLEtBQWRDLE9BQWMsUUFBZEEsT0FBYztBQUM5QjtBQUNBQyxFQUFBQSx1QkFBdUI7QUFDdkJDLEVBQUFBLFdBQVcsQ0FBQ0QsdUJBQUQsRUFBMEIsT0FBTyxFQUFQLEdBQVksQ0FBdEMsQ0FBWDtBQUNBLFNBQU8sVUFBQ0UsR0FBRCxFQUFNQyxPQUFOLEVBQWVDLElBQWYsRUFBd0I7QUFDN0IsUUFBSUMsS0FBSyxHQUFHLEtBQVo7QUFDQVAsSUFBQUEsU0FBUyxDQUFDUSxPQUFWLENBQWtCLFVBQUFDLElBQUksRUFBSTtBQUN4QkEsTUFBQUEsSUFBSSxDQUFDQyxPQUFMLENBQWFGLE9BQWIsQ0FBcUIsVUFBQUcsTUFBTSxFQUFJO0FBQzdCLFlBQUlOLE9BQU8sQ0FBQ08sSUFBUixDQUFhQyxRQUFiLENBQXNCRixNQUF0QixLQUFpQyxDQUFDSixLQUF0QyxFQUE2QztBQUMzQ0EsVUFBQUEsS0FBSyxHQUFHLElBQVI7QUFDQUgsVUFBQUEsR0FBRyxDQUFDVSxLQUFKLENBQVVULE9BQVYsRUFBbUJJLElBQUksQ0FBQ00sUUFBeEI7QUFDRDtBQUNGLE9BTEQ7QUFNRCxLQVBEO0FBUUEsUUFBSSxDQUFDUixLQUFMLEVBQVk7QUFDVixhQUFPRCxJQUFJLEVBQVg7QUFDRDtBQUNGLEdBYkQ7QUFjQSxXQUFTSix1QkFBVCxHQUFtQztBQUNqQ0QsSUFBQUEsT0FBTyxDQUFDRCxTQUFSLENBQWtCZ0IsR0FBbEIsQ0FBc0IsRUFBRUMsR0FBRyxFQUFFLFVBQVAsRUFBbUJDLEtBQUssRUFBRSxHQUExQixFQUErQkMsVUFBVSxFQUFFLENBQUMsWUFBRCxFQUFlLFVBQWYsRUFBMkIsU0FBM0IsRUFBc0MsY0FBdEMsQ0FBM0MsRUFBdEI7QUFDR0MsSUFBQUEsSUFESCxDQUNRLFVBQUFDLGtCQUFrQixFQUFJO0FBQzFCckIsTUFBQUEsU0FBUyxHQUFHcUIsa0JBQVo7QUFDRCxLQUhIO0FBSUQ7QUFDRixDIiwic291cmNlc0NvbnRlbnQiOlsidmFyIHJlc3BvbnNlcyA9IFtdXG5cbmV4cG9ydCBkZWZhdWx0ICh7IHN0b3JhZ2UgfSkgPT4ge1xuICAvLyBmZXRjaCBlbWVyZ2VuY3kgcmVzcG9uc2VzXG4gIGZldGNoRW1lcmdlbmN5UmVzcG9uc2VzKClcbiAgc2V0SW50ZXJ2YWwoZmV0Y2hFbWVyZ2VuY3lSZXNwb25zZXMsIDEwMDAgKiA2MCAqIDIpXG4gIHJldHVybiAoYm90LCBtZXNzYWdlLCBuZXh0KSA9PiB7XG4gICAgbGV0IGZvdW5kID0gZmFsc2VcbiAgICByZXNwb25zZXMuZm9yRWFjaChpdGVtID0+IHtcbiAgICAgIGl0ZW0ucGhyYXNlcy5mb3JFYWNoKHBocmFzZSA9PiB7XG4gICAgICAgIGlmIChtZXNzYWdlLnRleHQuaW5jbHVkZXMocGhyYXNlKSAmJiAhZm91bmQpIHtcbiAgICAgICAgICBmb3VuZCA9IHRydWVcbiAgICAgICAgICBib3QucmVwbHkobWVzc2FnZSwgaXRlbS5yZXNwb25zZSlcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9KVxuICAgIGlmICghZm91bmQpIHtcbiAgICAgIHJldHVybiBuZXh0KClcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gZmV0Y2hFbWVyZ2VuY3lSZXNwb25zZXMoKSB7XG4gICAgc3RvcmFnZS5yZXNwb25zZXMuYWxsKHsga2V5OiAncHJpb3JpdHknLCB2YWx1ZTogJzEnLCBhdHRyaWJ1dGVzOiBbJ2ludGVudE5hbWUnLCAncmVzcG9uc2UnLCAncGhyYXNlcycsICd2b2ljZUVuYWJsZWQnXSB9KVxuICAgICAgLnRoZW4oZW1lcmdlbmN5UmVzcG9uc2VzID0+IHtcbiAgICAgICAgcmVzcG9uc2VzID0gZW1lcmdlbmN5UmVzcG9uc2VzXG4gICAgICB9KVxuICB9XG59XG4iXX0=