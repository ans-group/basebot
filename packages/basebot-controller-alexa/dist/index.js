"use strict";Object.defineProperty(exports, "__esModule", { value: true });exports["default"] = void 0;var _botkit = require("botkit");
var _express = _interopRequireDefault(require("express"));
var _bodyParser = _interopRequireDefault(require("body-parser"));
var _alexaResponse = _interopRequireDefault(require("alexa-response"));
var _alexaReq = _interopRequireDefault(require("alexa-req"));var _this = void 0;function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { "default": obj };}

var AlexaBot = function AlexaBot(configuration) {
  // Create a core botkit bot
  var alexaBot = (0, _botkit.core)(configuration || {});

  // customize the bot definition, which will be used when new connections
  // spawn!
  alexaBot.defineBot(function (botkit, config) {
    var bot = {
      type: 'alexa',
      botkit: botkit,
      config: config || {},
      utterances: botkit.utterances };


    bot.startConversation = function (message, cb) {
      botkit.startConversation(_this, message, cb);
    };

    bot.createConversation = function (message, cb) {
      botkit.createConversation(_this, message, cb);
    };

    bot.findConversation = function (message, cb) {
      botkit.debug('CUSTOM FIND CONVO', message.user, message.channel);
      /* eslint-disable no-plusplus */
      for (var t = 0; t < botkit.tasks.length; t++) {
        for (var c = 0; c < botkit.tasks[t].convos.length; c++) {
          var con = botkit.tasks[t].convos[c];
          if (con.isActive() && con.source_message.user === message.user) {
            botkit.debug('FOUND EXISTING CONVO!');
            cb(botkit.tasks[t].convos[c]);
            return;
          }
        }
        /* eslint-enable */
      }
      cb();
    };

    bot.send = function (message) {var
      resp = message.resp;
      var isString = typeof resp === 'string';
      message.src.response.send((isString && _alexaResponse["default"].say(resp) || resp).build());
    };

    bot.reply = function (src, resp, cb) {
      var msg = { src: src, resp: resp };

      bot.say(msg, cb);
    };

    return bot;
  });

  // set up a web route for receiving incoming requests from alexa
  alexaBot.createWebhookEndpoints = function (webserver, bot) {
    // notify the user that the webhook is running
    alexaBot.log("** Serving webhook endpoint for Alexa Platform at: http://".concat(alexaBot.config.hostname, ":").concat(alexaBot.config.port, "/alexa/receive"));
    webserver.post('/alexa/receive', function (req, res) {
      alexaBot.debug('GOT A MESSAGE HOOK');

      // parse the request from alexa
      var alexa = new _alexaReq["default"](req.body);
      var message = {
        text: alexa.getIntentName(),
        user: alexa.getUserId(),
        channel: alexa.getUserId(),
        timestamp: alexa.getTimeStamp(),
        response: res,
        alexa: alexa

        // notify botkit we received a message
      };alexaBot.receiveMessage(bot, message);
    });

    return alexaBot;
  };

  alexaBot.setupWebserver = function (port, cb) {
    if (!port) {
      throw new Error('Cannot start webserver without a port');
    }

    alexaBot.config.port = port;

    alexaBot.webserver = (0, _express["default"])();
    alexaBot.webserver.use(_bodyParser["default"].json());
    alexaBot.webserver.use(_bodyParser["default"].urlencoded({ extended: true }));

    alexaBot.webserver.listen(alexaBot.config.port, alexaBot.config.hostname, function () {
      alexaBot.log("** Starting Alexa webserver on port ".concat(alexaBot.config.port));
      if (cb) {cb(null, alexaBot.webserver);}
    });

    return alexaBot;
  };

  return alexaBot;
};var _default =

AlexaBot;exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2luZGV4LmpzIl0sIm5hbWVzIjpbIkFsZXhhQm90IiwiY29uZmlndXJhdGlvbiIsImFsZXhhQm90IiwiZGVmaW5lQm90IiwiYm90a2l0IiwiY29uZmlnIiwiYm90IiwidHlwZSIsInV0dGVyYW5jZXMiLCJzdGFydENvbnZlcnNhdGlvbiIsIm1lc3NhZ2UiLCJjYiIsImNyZWF0ZUNvbnZlcnNhdGlvbiIsImZpbmRDb252ZXJzYXRpb24iLCJkZWJ1ZyIsInVzZXIiLCJjaGFubmVsIiwidCIsInRhc2tzIiwibGVuZ3RoIiwiYyIsImNvbnZvcyIsImNvbiIsImlzQWN0aXZlIiwic291cmNlX21lc3NhZ2UiLCJzZW5kIiwicmVzcCIsImlzU3RyaW5nIiwic3JjIiwicmVzcG9uc2UiLCJBbGV4YVJlc3BvbnNlIiwic2F5IiwiYnVpbGQiLCJyZXBseSIsIm1zZyIsImNyZWF0ZVdlYmhvb2tFbmRwb2ludHMiLCJ3ZWJzZXJ2ZXIiLCJsb2ciLCJob3N0bmFtZSIsInBvcnQiLCJwb3N0IiwicmVxIiwicmVzIiwiYWxleGEiLCJBbGV4YVJlcXVlc3QiLCJib2R5IiwidGV4dCIsImdldEludGVudE5hbWUiLCJnZXRVc2VySWQiLCJ0aW1lc3RhbXAiLCJnZXRUaW1lU3RhbXAiLCJyZWNlaXZlTWVzc2FnZSIsInNldHVwV2Vic2VydmVyIiwiRXJyb3IiLCJ1c2UiLCJib2R5UGFyc2VyIiwianNvbiIsInVybGVuY29kZWQiLCJleHRlbmRlZCIsImxpc3RlbiJdLCJtYXBwaW5ncyI6InVHQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkQ7O0FBRUEsSUFBTUEsUUFBUSxHQUFHLFNBQVhBLFFBQVcsQ0FBQ0MsYUFBRCxFQUFtQjtBQUNsQztBQUNBLE1BQU1DLFFBQVEsR0FBRyxrQkFBS0QsYUFBYSxJQUFJLEVBQXRCLENBQWpCOztBQUVBO0FBQ0E7QUFDQUMsRUFBQUEsUUFBUSxDQUFDQyxTQUFULENBQW1CLFVBQUNDLE1BQUQsRUFBU0MsTUFBVCxFQUFvQjtBQUNyQyxRQUFN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a0IsR0FBbkIsQ0FBdUJDLHVCQUFXQyxJQUFYLEVBQXZCO0FBQ0F0RCxJQUFBQSxRQUFRLENBQUNrQyxTQUFULENBQW1Ca0IsR0FBbkIsQ0FBdUJDLHVCQUFXRSxVQUFYLENBQXNCLEVBQUVDLFFBQVEsRUFBRSxJQUFaLEVBQXRCLENBQXZCOztBQUVBeEQsSUFBQUEsUUFBUSxDQUFDa0MsU0FBVCxDQUFtQnVCLE1BQW5CLENBQTBCekQsUUFBUSxDQUFDRyxNQUFULENBQWdCa0MsSUFBMUMsRUFBZ0RyQyxRQUFRLENBQUNHLE1BQVQsQ0FBZ0JpQyxRQUFoRSxFQUEwRSxZQUFNO0FBQzlFcEMsTUFBQUEsUUFBUSxDQUFDbUMsR0FBVCwrQ0FBb0RuQyxRQUFRLENBQUNHLE1BQVQsQ0FBZ0JrQyxJQUFwRTtBQUNBLFVBQUk1QixFQUFKLEVBQVEsQ0FBRUEsRUFBRSxDQUFDLElBQUQsRUFBT1QsUUFBUSxDQUFDa0MsU0FBaEIsQ0FBRixDQUE4QjtBQUN6QyxLQUhEOztBQUtBLFdBQU9sQyxRQUFQO0FBQ0QsR0FqQkQ7O0FBbUJBLFNBQU9BLFFBQVA7QUFDRCxDQWxHRCxDOztBQW9HZUYsUSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNvcmUgfSBmcm9tICdib3RraXQnXG5pbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJ1xuaW1wb3J0IGJvZHlQYXJzZXIgZnJvbSAnYm9keS1wYXJzZXInXG5pbXBvcnQgQWxleGFSZXNwb25zZSBmcm9tICdhbGV4YS1yZXNwb25zZSdcbmltcG9ydCBBbGV4YVJlcXVlc3QgZnJvbSAnYWxleGEtcmVxJ1xuXG5jb25zdCBBbGV4YUJvdCA9IChjb25maWd1cmF0aW9uKSA9PiB7XG4gIC8vIENyZWF0ZSBhIGNvcmUgYm90a2l0IGJvdFxuICBjb25zdCBhbGV4YUJvdCA9IGNvcmUoY29uZmlndXJhdGlvbiB8fCB7fSlcblxuICAvLyBjdXN0b21pemUgdGhlIGJvdCBkZWZpbml0aW9uLCB3aGljaCB3aWxsIGJlIHVzZWQgd2hlbiBuZXcgY29ubmVjdGlvbnNcbiAgLy8gc3Bhd24hXG4gIGFsZXhhQm90LmRlZmluZUJvdCgoYm90a2l0LCBjb25maWcpID0+IHtcbiAgICBjb25zdCBib3QgPSB7XG4gICAgICB0eXBlOiAnYWxleGEnLFxuICAgICAgYm90a2l0LFxuICAgICAgY29uZmlnOiBjb25maWcgfHwge30sXG4gICAgICB1dHRlcmFuY2VzOiBib3RraXQudXR0ZXJhbmNlc1xuICAgIH1cblxuICAgIGJvdC5zdGFydENvbnZlcnNhdGlvbiA9IChtZXNzYWdlLCBjYikgPT4ge1xuICAgICAgYm90a2l0LnN0YXJ0Q29udmVyc2F0aW9uKHRoaXMsIG1lc3NhZ2UsIGNiKVxuICAgIH1cblxuICAgIGJvdC5jcmVhdGVDb252ZXJzYXRpb24gPSAobWVzc2FnZSwgY2IpID0+IHtcbiAgICAgIGJvdGtpdC5jcmVhdGVDb252ZXJzYXRpb24odGhpcywgbWVzc2FnZSwgY2IpXG4gICAgfVxuXG4gICAgYm90LmZpbmRDb252ZXJzYXRpb24gPSAobWVzc2FnZSwgY2IpID0+IHtcbiAgICAgIGJvdGtpdC5kZWJ1ZygnQ1VTVE9NIEZJTkQgQ09OVk8nLCBtZXNzYWdlLnVzZXIsIG1lc3NhZ2UuY2hhbm5lbClcbiAgICAgIC8qIGVzbGludC1kaXNhYmxlIG5vLXBsdXNwbHVzICovXG4gICAgICBmb3IgKGxldCB0ID0gMDsgdCA8IGJvdGtpdC50YXNrcy5sZW5ndGg7IHQrKykge1xuICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IGJvdGtpdC50YXNrc1t0XS5jb252b3MubGVuZ3RoOyBjKyspIHtcbiAgICAgICAgICBjb25zdCBjb24gPSBib3RraXQudGFza3NbdF0uY29udm9zW2NdXG4gICAgICAgICAgaWYgKGNvbi5pc0FjdGl2ZSgpICYmIGNvbi5zb3VyY2VfbWVzc2FnZS51c2VyID09PSBtZXNzYWdlLnVzZXIpIHtcbiAgICAgICAgICAgIGJvdGtpdC5kZWJ1ZygnRk9VTkQgRVhJU1RJTkcgQ09OVk8hJylcbiAgICAgICAgICAgIGNiKGJvdGtpdC50YXNrc1t0XS5jb252b3NbY10pXG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIC8qIGVzbGludC1lbmFibGUgKi9cbiAgICAgIH1cbiAgICAgIGNiKClcbiAgICB9XG5cbiAgICBib3Quc2VuZCA9IChtZXNzYWdlKSA9PiB7XG4gICAgICBjb25zdCB7IHJlc3AgfSA9IG1lc3NhZ2VcbiAgICAgIGNvbnN0IGlzU3RyaW5nID0gdHlwZW9mIHJlc3AgPT09ICdzdHJpbmcnXG4gICAgICBtZXNzYWdlLnNyYy5yZXNwb25zZS5zZW5kKChpc1N0cmluZyAmJiBBbGV4YVJlc3BvbnNlLnNheShyZXNwKSB8fCByZXNwKS5idWlsZCgpKVxuICAgIH1cblxuICAgIGJvdC5yZXBseSA9IChzcmMsIHJlc3AsIGNiKSA9PiB7XG4gICAgICBjb25zdCBtc2cgPSB7IHNyYywgcmVzcCB9XG5cbiAgICAgIGJvdC5zYXkobXNnLCBjYilcbiAgICB9XG5cbiAgICByZXR1cm4gYm90XG4gIH0pXG5cbiAgLy8gc2V0IHVwIGEgd2ViIHJvdXRlIGZvciByZWNlaXZpbmcgaW5jb21pbmcgcmVxdWVzdHMgZnJvbSBhbGV4YVxuICBhbGV4YUJvdC5jcmVhdGVXZWJob29rRW5kcG9pbnRzID0gKHdlYnNlcnZlciwgYm90KSA9PiB7XG4gICAgLy8gbm90aWZ5IHRoZSB1c2VyIHRoYXQgdGhlIHdlYmhvb2sgaXMgcnVubmluZ1xuICAgIGFsZXhhQm90LmxvZyhgKiogU2VydmluZyB3ZWJob29rIGVuZHBvaW50IGZvciBBbGV4YSBQbGF0Zm9ybSBhdDogaHR0cDovLyR7YWxleGFCb3QuY29uZmlnLmhvc3RuYW1lfToke2FsZXhhQm90LmNvbmZpZy5wb3J0fS9hbGV4YS9yZWNlaXZlYClcbiAgICB3ZWJzZXJ2ZXIucG9zdCgnL2FsZXhhL3JlY2VpdmUnLCAocmVxLCByZXMpID0+IHtcbiAgICAgIGFsZXhhQm90LmRlYnVnKCdHT1QgQSBNRVNTQUdFIEhPT0snKVxuXG4gICAgICAvLyBwYXJzZSB0aGUgcmVxdWVzdCBmcm9tIGFsZXhhXG4gICAgICBjb25zdCBhbGV4YSA9IG5ldyBBbGV4YVJlcXVlc3QocmVxLmJvZHkpXG4gICAgICBjb25zdCBtZXNzYWdlID0ge1xuICAgICAgICB0ZXh0OiBhbGV4YS5nZXRJbnRlbnROYW1lKCksXG4gICAgICAgIHVzZXI6IGFsZXhhLmdldFVzZXJJZCgpLFxuICAgICAgICBjaGFubmVsOiBhbGV4YS5nZXRVc2VySWQoKSxcbiAgICAgICAgdGltZXN0YW1wOiBhbGV4YS5nZXRUaW1lU3RhbXAoKSxcbiAgICAgICAgcmVzcG9uc2U6IHJlcyxcbiAgICAgICAgYWxleGEgfVxuXG4gICAgICAvLyBub3RpZnkgYm90a2l0IHdlIHJlY2VpdmVkIGEgbWVzc2FnZVxuICAgICAgYWxleGFCb3QucmVjZWl2ZU1lc3NhZ2UoYm90LCBtZXNzYWdlKVxuICAgIH0pXG5cbiAgICByZXR1cm4gYWxleGFCb3RcbiAgfVxuXG4gIGFsZXhhQm90LnNldHVwV2Vic2VydmVyID0gKHBvcnQsIGNiKSA9PiB7XG4gICAgaWYgKCFwb3J0KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBzdGFydCB3ZWJzZXJ2ZXIgd2l0aG91dCBhIHBvcnQnKVxuICAgIH1cblxuICAgIGFsZXhhQm90LmNvbmZpZy5wb3J0ID0gcG9ydFxuXG4gICAgYWxleGFCb3Qud2Vic2VydmVyID0gZXhwcmVzcygpXG4gICAgYWxleGFCb3Qud2Vic2VydmVyLnVzZShib2R5UGFyc2VyLmpzb24oKSlcbiAgICBhbGV4YUJvdC53ZWJzZXJ2ZXIudXNlKGJvZHlQYXJzZXIudXJsZW5jb2RlZCh7IGV4dGVuZGVkOiB0cnVlIH0pKVxuXG4gICAgYWxleGFCb3Qud2Vic2VydmVyLmxpc3RlbihhbGV4YUJvdC5jb25maWcucG9ydCwgYWxleGFCb3QuY29uZmlnLmhvc3RuYW1lLCAoKSA9PiB7XG4gICAgICBhbGV4YUJvdC5sb2coYCoqIFN0YXJ0aW5nIEFsZXhhIHdlYnNlcnZlciBvbiBwb3J0ICR7YWxleGFCb3QuY29uZmlnLnBvcnR9YClcbiAgICAgIGlmIChjYikgeyBjYihudWxsLCBhbGV4YUJvdC53ZWJzZXJ2ZXIpIH1cbiAgICB9KVxuXG4gICAgcmV0dXJuIGFsZXhhQm90XG4gIH1cblxuICByZXR1cm4gYWxleGFCb3Rcbn1cblxuZXhwb3J0IGRlZmF1bHQgQWxleGFCb3RcbiJdfQ==